

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>xpipeline.waveform.xwaveform &mdash; xpipeline 0+untagged.178.gddc1b81.dirty documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/xpipeline-docs.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> xpipeline
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.178.gddc1b81.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../command-line/index.html">Running <code class="docutils literal notranslate"><span class="pre">xpipeline-workflow</span></code> on the command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">xpipeline an explanation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">xpipeline</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>xpipeline.waveform.xwaveform</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for xpipeline.waveform.xwaveform</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">CubicSpline</span>
<span class="kn">from</span> <span class="nn">gwpy.timeseries</span> <span class="k">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">.xoptimalsnr</span> <span class="k">import</span> <span class="n">xoptimalsnr</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">lal</span>
<span class="kn">import</span> <span class="nn">lalsimulation</span>

<span class="c1">###########################################################################</span>
<span class="c1">#   Physical constants.</span>
<span class="c1">###########################################################################</span>

<span class="c1">#-- 1 parsec (m)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="mf">3.08567756707701e+016</span>

<span class="c1">#-- 1 Mega-parsec (m)</span>
<span class="n">mpc</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">*</span><span class="n">pc</span>

<span class="c1">#-- speed of light (m/s)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">299792458</span>

<span class="n">newtong</span> <span class="o">=</span> <span class="mf">6.67e-11</span>
<span class="n">speedoflight_meterspersecond</span> <span class="o">=</span> <span class="mi">299792458</span>
<span class="n">megaparsec_meters</span> <span class="o">=</span> <span class="mf">1e6</span><span class="o">*</span><span class="mf">3.26</span><span class="o">*</span><span class="n">speedoflight_meterspersecond</span><span class="o">*</span><span class="mf">365.25</span><span class="o">*</span><span class="mi">86400</span>
<span class="n">solarmass_kilograms</span> <span class="o">=</span> <span class="mf">1.99e30</span>
<span class="n">solarmass_seconds</span> <span class="o">=</span> <span class="n">newtong</span><span class="o">*</span><span class="n">solarmass_kilograms</span><span class="o">/</span><span class="n">speedoflight_meterspersecond</span><span class="o">**</span><span class="mi">3</span>
<span class="n">solarmass_meters</span> <span class="o">=</span> <span class="n">newtong</span><span class="o">*</span><span class="n">solarmass_kilograms</span><span class="o">/</span><span class="n">speedoflight_meterspersecond</span><span class="o">**</span><span class="mi">2</span>
<span class="n">sqrt_of_neg_1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>

<div class="viewcode-block" id="xmakewaveform"><a class="viewcode-back" href="../../../api/xpipeline.waveform.xwaveform.html#xpipeline.waveform.xwaveform.xmakewaveform">[docs]</a><span class="k">def</span> <span class="nf">xmakewaveform</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">T0</span><span class="p">,</span> <span class="n">fs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create timeseries data containing a simulated GW.</span>

<span class="sd">       Parameters:</span>

<span class="sd">           family (str):</span>

<span class="sd">               A char or cell array containing one of (not case sensitive):</span>
<span class="sd">                  adi-a,...,-e  accretion disk</span>
<span class="sd">                                instability waveforms as used in STAMP searches</span>
<span class="sd">                  AORDDMJ10  Abdikamalov et al. accretion-induced collapse waveforms</span>
<span class="sd">                             [PRD81 044012 2010],</span>
<span class="sd">                  BLDOM07  Burrows et al. acoustic mechanism supernova waveforms</span>
<span class="sd">                             [ApJ655 416 2007],</span>
<span class="sd">                  CG  cosine-Gaussians (special case of &#39;chirplet&#39;),</span>
<span class="sd">                  chirplet  chirping sine/cosine-Gaussian,</span>
<span class="sd">                  cusp  waveform from a cosmic string cusp (see cuspgw.m),</span>
<span class="sd">                  DFM  NOT FUNCTIONAL. Dimmelmeier-Font-Mueller 2002 supernova waveforms,</span>
<span class="sd">                             relativistic simulations only [A&amp;A393 523 2002],</span>
<span class="sd">                             WARNING: Normalization may be incorrect.</span>
<span class="sd">                  DFMc  NOT FUNCTIONAL. Conditioned Dimmelmeier-Font-Mueller supernova</span>
<span class="sd">                             waveforms.  Same as DFM except detrended.</span>
<span class="sd">                             WARNING: Normalization may be incorrect.</span>
<span class="sd">                  DFM02  Dimmelmeier-Font-Mueller 2002 supernova waveforms,</span>
<span class="sd">                             relativistic &amp; Newtonian simulations, conditioned</span>
<span class="sd">                             and detrended [A&amp;A393 523 2002].</span>
<span class="sd">                             WARNING: Normalization may be incorrect.</span>
<span class="sd">                  DOJMM07  Dimmelmeier et al. 2007 supernova waveforms [PRL98</span>
<span class="sd">                             251101 2007],</span>
<span class="sd">                  DOMJ08  Dimmelmeier et al. 2008 supernova waveforms [PRD78</span>
<span class="sd">                             064056 2008]</span>
<span class="sd">                  DS  damped sinusoids,</span>
<span class="sd">                  DS2P  2-polarization damped sinusoids with smooth turn-on,</span>
<span class="sd">                  ebbh-a,...,-e  eccentric binary black-hole waveforms as used in STAMP</span>
<span class="sd">                                 searches</span>
<span class="sd">                  G  Gaussians (special case of &#39;chirplet&#39;),</span>
<span class="sd">                  inspiral    post-Newtonian inspiral,</span>
<span class="sd">                  inspiralgated  As inspiralsmooth, with a gate applied centered 1 sec</span>
<span class="sd">                             before coalescence time. Gate is 0.5 sec hann roll-off,</span>
<span class="sd">                             0.3 sec zeros, 0.5 sec hann roll-on.</span>
<span class="sd">                  inspiralsmooth  post-Newtonian inspiral, tapered at the end</span>
<span class="sd">                  iscochirp*  Broadband chirps from ISCO waves around rotating black holes,</span>
<span class="sd">                             from https://arxiv.org/abs/1602.03634 (Van Putten)</span>
<span class="sd">                  kotake09  Kotake et al. supernova waveform -- NEED INFO,</span>
<span class="sd">                  lalinspiral  post-Newtonian inspiral, generated using LALsuite</span>
<span class="sd">                  Lazarus  Lazarus project black-hole merger waveforms (analytic</span>
<span class="sd">                             approximation) [PRD65 124012 2002],</span>
<span class="sd">                  longbar  long-lived bar mode,</span>
<span class="sd">                  magnetar  GW emission by magnetar undergoing spin down caused by EM</span>
<span class="sd">                             and/or EM emission,</span>
<span class="sd">                  marek09  Marek et al. 2009 supernova waveforms -- NEED INFO,</span>
<span class="sd">                  methodspaper  One of four numerical supernova waveforms from</span>
<span class="sd">                             http://arxiv.org/abs/1110.5107v2.</span>
<span class="sd">                  mono       Monochromatic waveforms used by STAMP-AS (including mono-*,</span>
<span class="sd">                             line-*, quad-*) see https://wiki.ligo.org/Main/O1analysisInjections,</span>
<span class="sd">                  mob09      Murphy-Ott-Burrows 2009 supernova waveforms</span>
<span class="sd">                             [arXiv:0907.4762],</span>
<span class="sd">                  murphy09  Murphy+09 waveforms</span>
<span class="sd">                  mvp       van Putten based waveform model -- NEED INFO,</span>
<span class="sd">                  NCSA-CAM  eccentric binary neutron star mergers, generated with the</span>
<span class="sd">                             NCSA-CAM waveform model. The waveforms start at 15Hz and</span>
<span class="sd">                             continue through merger and ringdown. See</span>
<span class="sd">                             https://dcc.ligo.org/DocDB/0140/G1700265/001/ecc_presentation.pdf</span>
<span class="sd">                  OBDL06     Ott, Burrows, Dessart, &amp; Livne supernova waveforms</span>
<span class="sd">                             [PRL 96 201102 2006]</span>
<span class="sd">                  OBLW04     Ott-Burrows-Livne-Walder 2004 supernova waveforms</span>
<span class="sd">                             [ApJ600 834 2004],</span>
<span class="sd">                  onecyclesine  single cycle (phase -pi-&gt;0-&gt;pi) of a sine wave,</span>
<span class="sd">                  osnsearch  test waveform used in S5/S6 optical supernova search,</span>
<span class="sd">                  o1snews  Waveforms for O1 X SNEWS Search.</span>
<span class="sd">                  O09  Ott SASI supernova waveforms [CQG26 063001 2009],</span>
<span class="sd">                  O10  Ott 2010 supernova waveforms -- NEED INFO,</span>
<span class="sd">                  PCA  Principle Component Analysis Wave Forms</span>
<span class="sd">                  piro  NOT FUNCTIONAL. Piro-based waveform model -- NEED INFO,</span>
<span class="sd">                  scalarchirplet  scalar-mode chirping cosine-Gaussian,</span>
<span class="sd">                  pmns_pca  A large number of precalculated Post-Merger Remnant Signals for a</span>
<span class="sd">                             variety of EOS mass configurations. some include</span>
<span class="sd">                             &#39;nl3_1515&#39; &#39;tma_1215&#39; &#39;tma_1212&#39; &#39;dd2_1314&#39;</span>
<span class="sd">                             &#39;ls375_1215&#39; &#39;dd2_1215&#39; &#39;dd2_165165&#39; &#39;tma_1515&#39;</span>
<span class="sd">                             &#39;ls375_1212&#39; &#39;ls220_1414&#39;</span>
<span class="sd">                  scalarsn  Model A follows solution number 4 from Table 1 for a 1.5</span>
<span class="sd">                             solar mass star undergoing spontaneous scalarization. See</span>
<span class="sd">                             http://journals.aps.org/prd/abstract/10.1103/PhysRevD.58.064019</span>
<span class="sd">                             Model B follows the collpase of aspherical NS star to</span>
<span class="sd">                             blackhole following solution B in table 1.</span>
<span class="sd">                             http://journals.aps.org/prd/abstract/10.1103/PhysRevD.57.4789</span>
<span class="sd">                             Models C, D, E are Novak and Ibanez scalar supernovae waveforms.</span>
<span class="sd">                            http://stacks.iop.org/0004-637X/533/i=1/a=392</span>
<span class="sd">                  scheide    Scheidegger et al. 2010 equatorial waveforms -- NEED INFO,</span>
<span class="sd">                  scheidp     Scheidegger et al. 2010 for polar waveforms -- NEED INFO,</span>
<span class="sd">                         SG  sine-Gaussians (special case of &#39;chirplet&#39;),</span>
<span class="sd">                  snmp  Waveforms used for SN Methods Paper that are not included in</span>
<span class="sd">                         osnsearch.</span>
<span class="sd">                  SNN94  Shibata, Nakao, and Nakamura scalar-mode GWs from</span>
<span class="sd">                             gravitational collapse [PRD 50 7304 1994],</span>
<span class="sd">                  stamp_*  STAMP-AS waveforms for O1 long-duration search see</span>
<span class="sd">                             https://wiki.ligo.org/Bursts/Allsky20160425</span>
<span class="sd">                  WNB  windowed, band-limited white-noise burst (2 independent</span>
<span class="sd">                             polarizations).</span>
<span class="sd">                  Yakunin2010  Yakunin et al. http://arxiv.org/abs/1005.0779</span>
<span class="sd">                  zero  null signal (hp=0=hc),</span>
<span class="sd">                  ZM  Zwerger-Mueller supernova waveforms [A&amp;A320 209 1997].</span>
<span class="sd">                             WARNING: Normalization may be incorrect see eqn (21) of</span>
<span class="sd">                             the reference.</span>
<span class="sd">           params (Array, or tilde-delimited string):</span>

<span class="sd">               containing parameters for the specified waveform type.  The format and</span>
<span class="sd">               definition of the parameters depend on the waveform type.  For</span>
<span class="sd">               details on a specific waveform, e.g. WNB, do xmakewaveform(&#39;WNB&#39;).</span>

<span class="sd">           T (`int`):</span>
<span class="sd">               Duration of the waveform.  Must have T*fs = integer.</span>
<span class="sd">               Recommend T&gt;=1 for astrophysical waveforms.</span>

<span class="sd">           T0 (`int`):</span>
<span class="sd">               Desired peak time of the waveform, as measured in hrss</span>
<span class="sd">               for (hp.^+hc.^2).^(0.5).  Must have 0&lt;T0&lt;T.  See &quot;Notes&quot; below</span>
<span class="sd">               for caveats.</span>

<span class="sd">           fs (`int`):</span>
<span class="sd">               Sampling rate of the time series.  T*fs must be an</span>
<span class="sd">           integer.</span>

<span class="sd">       Returns:</span>
<span class="sd">           t:</span>
<span class="sd">               Times at which the waveform is sampled, starting from zero.</span>
<span class="sd">           hp:</span>
<span class="sd">               Plus polarization waveform [strain].</span>
<span class="sd">           hc:</span>
<span class="sd">               Cross polarization waveform [strain].</span>
<span class="sd">           hb:</span>
<span class="sd">               Breathing (scalar) polarization waveform [strain].  Identically</span>
<span class="sd">               zero for all waveform types unless explicitly stated otherwise.</span>

<span class="sd">       Notes:</span>

<span class="sd">            The waveform is interpolated so that the RSS-weighted center time,</span>
<span class="sd">            [\int dt t (hp.^+hc.^2+hb.^2)].^(0.5), is at T0.  Note that for</span>
<span class="sd">            2-polarization waveforms that include an inclination angle (eg, DS2P)</span>
<span class="sd">            different inclination angles will cause hp, hc to be weighted differently</span>
<span class="sd">            and therefore will produce different shifts.</span>

<span class="sd">            The cusp waveform (generated by P. Shawhan&#39;s cuspgw function) and most</span>
<span class="sd">            astrophysical waveforms that are loaded from files are always 1 sec long</span>
<span class="sd">            with sampling rate 16384 Hz when created/loaded. These are resampled</span>
<span class="sd">            linearly and truncated or zero-padded to the desired length.  One should</span>
<span class="sd">            be cautious in using T&lt;1 for these waveforms.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">###########################################################################</span>
    <span class="c1">#   Check inputs.</span>
    <span class="c1">###########################################################################</span>

    <span class="n">inclinationtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inclinationtype&#39;</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">inclinationtype</span> <span class="o">==</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span>
        <span class="n">use_total_inclination</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">inclinationtype</span> <span class="o">==</span> <span class="s1">&#39;orbital&#39;</span><span class="p">:</span>
        <span class="n">use_total_inclination</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">hrss</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hrss&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">filedir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;catalogdirectory&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;/home/scoughlin/PhD/waveforms/&#39;</span><span class="p">)</span>

    <span class="c1">###########################################################################</span>
    <span class="c1">#   Other preparatory.</span>
    <span class="c1">###########################################################################</span>

    <span class="c1">#----- Boolean: If true then waveform &quot;type&quot; specifies a waveform made</span>
    <span class="c1">#      outside of this function (loaded from file, or using another</span>
    <span class="c1">#      function) and which therefore may need to be re-sampled, shifted in</span>
    <span class="c1">#      time, zero-padded, or truncated.</span>
    <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1">#-- By default perform conditioning on everything.</span>
    <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">fs</span>  <span class="c1">#-- sampling rate of pregenerated waveform.</span>
    <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">T</span>    <span class="c1">#-- duration of pregenerated waveform.</span>

    <span class="c1">#----- Time in column vector.</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>

    <span class="n">hb</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#----- If parameters are supplied as tilde-delimited string, then convert</span>
    <span class="c1">#      to cell or double array.</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">string_</span><span class="p">]:</span>
        <span class="n">parameters_tmp</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">parameters_tmp</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        

    <span class="k">if</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;aorddmj10&#39;</span><span class="p">,</span> <span class="s1">&#39;dojmm07&#39;</span><span class="p">,</span> <span class="s1">&#39;domj08&#39;</span><span class="p">,</span> <span class="s1">&#39;mob09&#39;</span><span class="p">,</span> <span class="s1">&#39;obdl06&#39;</span><span class="p">,</span> <span class="s1">&#39;oblw04&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Entry from one of various supernova waveform catalogs</span>
        <span class="c1">#       (pregenerated).</span>

        <span class="c1"># ---- Find specified waveform type.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">/</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;murphy09&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Entry from one of various supernova waveform catalogs</span>
        <span class="c1">#       (pregenerated).</span>

        <span class="c1"># ---- Find specified waveform type.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hrss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Find specified waveform type.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">hp</span> <span class="o">/</span> <span class="n">hrss</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;adi-a&#39;</span><span class="p">,</span> <span class="s1">&#39;adi-b&#39;</span><span class="p">,</span> <span class="s1">&#39;adi-c&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;adi-d&#39;</span><span class="p">,</span><span class="s1">&#39;adi-e&#39;</span><span class="p">,</span><span class="s1">&#39;ebbh-a&#39;</span><span class="p">,</span><span class="s1">&#39;ebbh-d&#39;</span><span class="p">,</span><span class="s1">&#39;ebbh-e&#39;</span><span class="p">]:</span>

        <span class="n">familyname</span> <span class="o">=</span> <span class="n">family</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span>
                                          <span class="n">familyname</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">familyname</span><span class="p">,</span> <span class="n">family</span><span class="p">))</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span>
                                          <span class="n">familyname</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">familyname</span><span class="p">,</span> <span class="n">family</span><span class="p">))</span>

        <span class="c1"># ---- Parse parameters.</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#-- mpc</span>
        <span class="n">ciota</span>    <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#-- inclination</span>

        <span class="c1"># ---- Extract +/x polarizations. Default distance is 1 mpc. Assume</span>
        <span class="c1">#      l=m=2 mode dominates when applying inclination.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ciota</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp</span> <span class="o">/</span> <span class="n">distance</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">ciota</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">/</span> <span class="n">distance</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ----  Set &quot;pregenerated&quot; variables.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bldom07&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  acoustic.</span>
        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">distance</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cg&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- cosine-Gaussians.</span>
        <span class="n">h_rss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">h_peak</span> <span class="o">=</span> <span class="n">h_rss</span> <span class="o">*</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">f0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Q</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f0</span><span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">h_peak</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span><span class="p">)</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Turn off default interpolation (symmetric ad hoc waveform).</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;chirplet&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- Chirplet - Gaussian-modulated sinusoid with frequency</span>
        <span class="c1">#      changing linearly with time.  Put chirping cosine-Gaussian</span>
        <span class="c1">#      in plus polarization, chirping sine-Gaussian in cross.</span>

        <span class="c1"># ---- Required parameters.</span>
        <span class="n">h_rss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ---- Optional parameters.</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ciota</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">ciota</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1"># ---- Waveform.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h_rss</span> <span class="o">*</span> <span class="p">(</span>
                     <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                              <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span>
                              <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                              <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span><span class="n">f0</span>
                              <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                     <span class="o">/</span> 
                     <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chirplet&#39;</span><span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">ciota</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">h</span><span class="o">.</span><span class="n">real</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">ciota</span> <span class="o">*</span> <span class="n">h</span><span class="o">.</span><span class="n">imag</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Turn off default interpolation (ad hoc waveform is designed</span>
        <span class="c1">#      to produce desired T0).</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dfm02&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Dimmelmeier, Font, and Mueller supernova waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">distance</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ds&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- Damped sinusoids with sharp turn-on.</span>
        <span class="n">h_peak</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span><span class="o">&gt;=</span><span class="n">T0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_peak</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> 
                                   <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span><span class="p">)</span>
                         <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">))</span>
        <span class="n">hc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_peak</span> <span class="o">*</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> 
                                    <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span><span class="p">)</span>
                         <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau</span><span class="p">))</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Force interpolation to get correct T0, since waveform is</span>
        <span class="c1">#      asymmetric.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ds2p&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- Damped sinusoids, 2-polarization, with smooth turn-on.</span>
        <span class="n">h_peak</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">ciota</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="c1"># ---- Smooth turn on: prepend time-reversed damped sinusoid with</span>
        <span class="c1">#      same parameters, except tau-&gt;tau/10.</span>
        <span class="n">tau_vec</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t</span><span class="o">&lt;</span><span class="n">T0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau_vec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau_vec</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mf">10.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">h_peak</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ciota</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                                            <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span>
                                            <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau_vec</span><span class="p">)</span>
                                           <span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">h_peak</span> <span class="o">*</span> <span class="n">ciota</span> <span class="o">*</span> <span class="p">(</span>
                               <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">*</span><span class="n">f0</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span>
                               <span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">/</span> <span class="n">tau_vec</span><span class="p">)</span>
                              <span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">hp</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">hc</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Force interpolation to get correct T0, since waveform is</span>
        <span class="c1">#      asymmetric.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- Gaussians.</span>
        <span class="n">h_rss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">h_peak</span> <span class="o">=</span> <span class="n">h_rss</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">h_peak</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">tau</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Turn off default interpolation (symmetric ad hoc waveform).</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;inspiral&#39;</span><span class="p">]:</span>
        <span class="n">mass1</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mass2</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">inclination</span>  <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">dist</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hp</span><span class="p">,</span> <span class="n">hc</span> <span class="o">=</span> <span class="n">lalsimulation</span><span class="o">.</span><span class="n">SimInspiralTD</span><span class="p">(</span>
                    <span class="c1"># Masses</span>
                    <span class="n">mass1</span> <span class="o">*</span> <span class="n">lal</span><span class="o">.</span><span class="n">MSUN_SI</span><span class="p">,</span> <span class="n">mass2</span> <span class="o">*</span> <span class="n">lal</span><span class="o">.</span><span class="n">MSUN_SI</span><span class="p">,</span>
                    <span class="c1"># Spins</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="c1"># distance and inclination</span>
                    <span class="n">dist</span> <span class="o">*</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="n">lal</span><span class="o">.</span><span class="n">PC_SI</span><span class="p">,</span> <span class="n">inclination</span><span class="p">,</span>
                    <span class="c1"># These are eccentricity and other orbital parameters</span>
                    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="c1"># frequency binning params</span>
                    <span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="c1"># Other extraneous options</span>
                    <span class="n">params</span><span class="p">,</span>
                    <span class="n">lalsimulation</span><span class="o">.</span><span class="n">SimInspiralGetApproximantFromString</span><span class="p">(</span><span class="s1">&#39;TaylorT2&#39;</span><span class="p">))</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_lal</span><span class="p">(</span><span class="n">hp</span><span class="p">)</span>
        <span class="n">hp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">family</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_lal</span><span class="p">(</span><span class="n">hc</span><span class="p">)</span>
        <span class="n">hc</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">family</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;inspiralsmooth&#39;</span><span class="p">,</span> <span class="s1">&#39;inspiralgated&#39;</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # ---- Post-Newtonian inspiral waveform, using INSPIRAL2PN.</span>
<span class="sd">        mass1 = parameters(1)</span>
<span class="sd">        mass2 = parameters(2)</span>
<span class="sd">        iota  = acos(parameters(3))</span>
<span class="sd">        dist  = parameters(4)</span>
<span class="sd">        [hp, hc, tpn, tinspiral] = inspiral2pn(mass1,mass2,iota,dist,fs,T,T0)</span>
<span class="sd">        inspiralEnd = length(tinspiral)</span>
<span class="sd">        taperLength = round(fs/512)</span>
<span class="sd">        taper = hann(2*taperLength+1)</span>
<span class="sd">        if(length(hp)&lt;10*taperLength)</span>
<span class="sd">          error(&#39;Inspiral waveform is too short for smoothing&#39;)</span>
<span class="sd">        end</span>
<span class="sd">        hp(inspiralEnd-taperLength:inspiralEnd) = ...</span>
<span class="sd">            hp(inspiralEnd-taperLength:inspiralEnd).*taper(end-taperLength:end)</span>
<span class="sd">        hc(inspiralEnd-taperLength:inspiralEnd) = ...</span>
<span class="sd">            hc(inspiralEnd-taperLength:inspiralEnd).*taper(end-taperLength:end)</span>

<span class="sd">        if strcmpi(lower(type),&#39;inspiralgated&#39;)</span>
<span class="sd">            # ---- Apply gate to waveform centered 1 sec before coalescence</span>
<span class="sd">            #      time. Gate is 0.5 sec hann roll-off, 0.3 sec zeros,</span>
<span class="sd">            #      0.5 sec hann roll-on. So gate starts 1+0.15*0.5 sec = 1.65 sec</span>
<span class="sd">            #      before coalescence.</span>
<span class="sd">            taper = hann(fs)</span>
<span class="sd">            gate = [taper(end/2+1:end) zeros(round(0.3*fs),1) taper(1:end/2)]</span>
<span class="sd">            gatelength = length(gate)</span>
<span class="sd">            [val,idx] = min(abs(t-(T0-1.65)))</span>
<span class="sd">            hp((idx+1):(idx+gatelength)) =  gate .* hp((idx+1):(idx+gatelength))</span>
<span class="sd">            hc((idx+1):(idx+gatelength)) =  gate .* hc((idx+1):(idx+gatelength))</span>
<span class="sd">        end</span>

<span class="sd">        # ---- Turn off default interpolation (leave coalescence time</span>
<span class="sd">        #      intact).</span>
<span class="sd">        pregen = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;kotake09&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Dimmelmeier, Font, and Mueller supernova waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>


        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lalinspiral&#39;</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # --- add sampling frequency to parameters</span>
<span class="sd">        if iscell(parameters)</span>
<span class="sd">          parameters = {fs, parameters{:}}</span>
<span class="sd">        else</span>
<span class="sd">          parameters = num2cell([fs parameters(:)])</span>
<span class="sd">        end</span>

<span class="sd">        # --- realign binary so that inclination referes to angle between</span>
<span class="sd">        # total angular momentum and line of sight</span>
<span class="sd">        if use_total_inclination</span>
<span class="sd">          parameters = alignTotalSpin(parameters)</span>
<span class="sd">        end</span>

<span class="sd">        # ---- Post-Newtonian inspiral waveform, using LALGenerateInspiral</span>
<span class="sd">        [tLAL, hpLAL, hcLAL, freq, a1LAL, a2LAL] = lalinspiral(parameters)</span>

<span class="sd">        # ---- Align coalescence time with T0 in the requested [0,T]</span>
<span class="sd">        #      window, chop or fill with zeros to complete the waveform</span>
<span class="sd">        hp=zeros(size(t))</span>
<span class="sd">        hc=zeros(size(t))</span>
<span class="sd">        nTimeBins = min(length(tLAL),sum(t&lt;=T0))-1</span>
<span class="sd">        copyRange = (length(tLAL)-nTimeBins):length(tLAL)</span>
<span class="sd">        pasteRange = find(t&lt;=T0)</span>
<span class="sd">        pasteRange = pasteRange((end-nTimeBins):end)</span>
<span class="sd">        hp(pasteRange) = hpLAL(copyRange)</span>
<span class="sd">        hc(pasteRange) = hcLAL(copyRange)</span>
<span class="sd">        a1(pasteRange) = a1LAL(copyRange)</span>
<span class="sd">        a2(pasteRange) = a2LAL(copyRange)</span>

<span class="sd">        # ---- Turn off default interpolation (leave coalescence time</span>
<span class="sd">        #      intact).</span>
<span class="sd">        pregen = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lazarus&#39;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        # ---- Lazarus Project black-hole mergers.  Use analytic</span>
<span class="sd">        #      approximation from Baker, Campanelli, Lousto, and Takahashi,</span>
<span class="sd">        #      PRD 65 124012 2002.</span>

<span class="sd">        # ---- Input parameters.</span>
<span class="sd">        mass_solarMasses = parameters[0]</span>
<span class="sd">        distance_megaParsecs = parameters[1]</span>
<span class="sd">        ciota = parameters[2]</span>

<span class="sd">        # ---- Constants of analytic approximation.</span>
<span class="sd">        alpha0 = 0.0085</span>
<span class="sd">        omega0 = 0.2894</span>
<span class="sd">        tomega0 = 33.00</span>
<span class="sd">        tomega1 = 67.05</span>
<span class="sd">        sigma0 = 0.2192</span>
<span class="sd">        tsigma0 = 32.54</span>
<span class="sd">        tsigma1 = 62.92</span>
<span class="sd">        omegaQNM = 0.55</span>
<span class="sd">        sigmaQNM = -0.073</span>
<span class="sd">        phi0 = -4.40</span>
<span class="sd">        a0 = -6.31</span>

<span class="sd">        # ---- This range of t includes the entire range where the envelope</span>
<span class="sd">        #      A &gt; 1e-4*max(A).</span>
<span class="sd">        dt = 0.1  #-- fine enough resolution (in units of system mass)</span>
<span class="sd">        tmin = 0</span>
<span class="sd">        tmax = 200 #-- range over which analytic approximation has support</span>
<span class="sd">        t = numpy.arange(tmin, tmax, dt)</span>

<span class="sd">        # ---- Construct phase phi(t) piecewise in time.</span>
<span class="sd">        phi = numpy.zeros(t.size)</span>
<span class="sd">        k = numpy.where(t&lt;tomega0)[0]</span>
<span class="sd">        phi[k] = phi0 + omega0*(t[k] - tomega0) + alpha0/2*(t[k]-tomega0)**2</span>
<span class="sd">        k = numpy.where( (t&gt;=tomega0) &amp; (t&lt;tomega1) )[0]</span>
<span class="sd">        phi[k] = phi0 + omega0*(t[k] - tomega0) ...</span>
<span class="sd">            + (omega0 - omegaQNM)/(tomega0 - tomega1) / 2*(t[k] - tomega0)**2</span>
<span class="sd">        k = numpy.where(t&gt;=tomega1)[0]</span>
<span class="sd">        phi[k] = phi0 + 1./2 * ((omega0 + omegaQNM) * (tomega1-tomega0)</span>
<span class="sd">            + omegaQNM*(t[k] - tomega1))</span>

<span class="sd">        # ---- Construct amplitude A(t) piecewise in time.</span>
<span class="sd">        lnA = numpy.zeros(t.size)</span>
<span class="sd">        k = numpy.where(t&lt;tsigma0)[0]</span>
<span class="sd">        lnA[k] = a0 + sigma0*(t[k]-tsigma0)</span>
<span class="sd">        k = numpy.where( (t&gt;=tsigma0) &amp; (t&lt;tsigma1) )[0]</span>
<span class="sd">        lnA[k] = a0 + sigma0*(t[k]-tsigma0) ...</span>
<span class="sd">            + 1./2*(sigma0-sigmaQNM)/(tsigma0-tsigma1) * (t[k]-tsigma0)**2</span>
<span class="sd">        k = numpy.where(t&gt;=tsigma1)[0]</span>
<span class="sd">        lnA[k] = a0 + 1./2*(sigma0+sigmaQNM)*(tsigma1-tsigma0) ...</span>
<span class="sd">            + sigmaQNM*(t[k]-tsigma1)</span>
<span class="sd">        A = numpy.exp(lnA)</span>

<span class="sd">        # ---- Construct r*Psi_4 variable.</span>
<span class="sd">        rPsi4 = A * numpy.exp(-srt_of_neg_1 * phi)</span>

<span class="sd">        # ---- Integrate twice in time to get hplus, hcross.</span>
<span class="sd">        ddhp = real(2*rPsi4)</span>
<span class="sd">        ddhc = imag(2*rPsi4)</span>
<span class="sd">        dhp = dt*real(cumsum(2*rPsi4))</span>
<span class="sd">        dhc = dt*imag(cumsum(2*rPsi4))</span>
<span class="sd">        hp = dt^2*real(cumsum(cumsum(2*rPsi4)))</span>
<span class="sd">        hc = dt^2*imag(cumsum(cumsum(2*rPsi4)))</span>
<span class="sd">        # ---- Remove linear trend in hplus.</span>
<span class="sd">        tint = t(end)-hp(end)/dhp(end)</span>
<span class="sd">        m = dhp(end)</span>
<span class="sd">        b = hp(end) - dhp(end)*t(end)</span>
<span class="sd">        hp_trend = zeros(size(t))</span>
<span class="sd">        k = find(t&gt;tint)</span>
<span class="sd">        hp_trend(k) = m*t(k)+b</span>
<span class="sd">        hp = hp - hp_trend</span>
<span class="sd">        # ---- Remove linear trend in hcross.</span>
<span class="sd">        tint = t(end)-hc(end)/dhc(end)</span>
<span class="sd">        m = dhc(end)</span>
<span class="sd">        b = hc(end) - dhc(end)*t(end)</span>
<span class="sd">        hc_trend = zeros(size(t))</span>
<span class="sd">        k = find(t&gt;tint)</span>
<span class="sd">        hc_trend(k) = m*t(k)+b</span>
<span class="sd">        hc = hc - hc_trend</span>

<span class="sd">        # ---- Rescale to seconds and megaParsecs.</span>
<span class="sd">        t = t * mass_solarMasses * solarmass_seconds</span>
<span class="sd">        hp = hp * ( mass_solarMasses * solarmass_meters ) ...</span>
<span class="sd">            / ( distance_megaParsecs * megaparsec_meters )</span>
<span class="sd">        hc = hc * ( mass_solarMasses * solarmass_meters ) ...</span>
<span class="sd">            / ( distance_megaParsecs * megaparsec_meters )</span>

<span class="sd">        # ---- Rescale waveforms according to inclination angle.</span>
<span class="sd">        hp = hp*(0.5*(1+ciota^2))</span>
<span class="sd">        hc = hc*ciota</span>

<span class="sd">        # ---- Set pregen flag so we will interpolate to desired sampling</span>
<span class="sd">        #      rate, etc.</span>
<span class="sd">        pregen = 1</span>
<span class="sd">        pregen_T = length(t) * dt * mass_solarMasses * solarmass_seconds</span>
<span class="sd">        pregen_fs = length(t)/pregen_T</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;longbar&#39;</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # ---- Figure out parameters and call helper function.</span>
<span class="sd">        # [D,M,L,R,f,tau,phi,theta]</span>
<span class="sd">        D  = parameters(1)</span>
<span class="sd">        M = parameters(2)</span>
<span class="sd">        L = parameters(3)</span>
<span class="sd">        R  = parameters(4)</span>
<span class="sd">        f  = parameters(5)</span>
<span class="sd">        tau  = parameters(6)</span>
<span class="sd">        phi  = parameters(7)</span>
<span class="sd">        theta  = parameters(8)</span>
<span class="sd">        [dummy, hp, hc] = longbar(D, M, L, R, f, tau, 0, 0)</span>
<span class="sd">        hb = zeros(size(hp))</span>

<span class="sd">        # ---- Long-lived bar mode waveform (pregenerated).</span>
<span class="sd">        pregen = 1</span>
<span class="sd">        pregen_fs = fs</span>
<span class="sd">        pregen_T = length(hp)/pregen_fs</span>

<span class="sd">        # ---- Time vector for pregenerated waveform.</span>
<span class="sd">        pregen_t = [0:1/pregen_fs:pregen_T-1/pregen_fs].T</span>
<span class="sd">        # ---- Measure peak/characteristic time of pregenerated waveform.</span>
<span class="sd">        [SNR, h_rss, h_peak, Fchar, bw, Tchar, dur] = xoptimalsnr( ...</span>
<span class="sd">            [hp,hc,hb],pregen_t(1),pregen_fs,[],[],[], ...</span>
<span class="sd">            1/pregen_T,0.5*pregen_fs-1/pregen_T ...</span>
<span class="sd">        )</span>
<span class="sd">        # ---- Shift pregenerated time vector by required amount.</span>
<span class="sd">        pregen_t = pregen_t + (T0 - Tchar)</span>
<span class="sd">        # ---- Interpolate to correct sampling rate and peak time.</span>
<span class="sd">        # ---- Time in column vector.</span>
<span class="sd">        t = [0:1/fs:T-1/fs].T</span>
<span class="sd">        # ---- Find desired times which overlap pregen_t.</span>
<span class="sd">        k = find(t&gt;=pregen_t(1) &amp; t&lt;=pregen_t(end))</span>
<span class="sd">        # ---- Interpolate, with zero padding if pregenerated waveform is too</span>
<span class="sd">        #      short.  (Truncation of long waveforms handled automatically by</span>
<span class="sd">        #      specifying vector &quot;t&quot;.)</span>
<span class="sd">        hp_interp = zeros(size(t))</span>
<span class="sd">        hc_interp = zeros(size(t))</span>
<span class="sd">        hb_interp = zeros(size(t))</span>
<span class="sd">        hp_interp(k) = interp1(pregen_t,hp,t(k))</span>
<span class="sd">        hc_interp(k) = interp1(pregen_t,hc,t(k))</span>
<span class="sd">        hb_interp(k) = interp1(pregen_t,hb,t(k))</span>
<span class="sd">        hp = hp_interp</span>
<span class="sd">        hc = hc_interp</span>
<span class="sd">        hb = hb_interp</span>
<span class="sd">        hp = 0.5 * (1 + (cos(theta))^2) * hp</span>
<span class="sd">        hc = cos(theta) * hc</span>
<span class="sd">        pregen = 0</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;magnetar&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Lasky et al. magnetar waveform see https://wiki.ligo.org/Main/LongDurationRemnantWaveforms .</span>

        <span class="c1"># ---- Parse parameters.</span>
        <span class="n">hrss</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1">#-- Hz^-0.5</span>
        <span class="n">ciota</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1">#-- inclination</span>

        <span class="c1"># ---- Load waveform structure, if not already loaded or supplied.</span>
        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">family</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">family</span><span class="p">))</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ----  Set &quot;pregenerated&quot; variables.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># ---- Extract +/x polarizations and rescale to desired hrss at</span>
        <span class="c1">#      OPTIMAL inclination.</span>
        <span class="n">hrss_default</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">hp</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">hc</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">hp</span> <span class="o">*</span> <span class="n">hrss</span> <span class="o">/</span> <span class="n">hrss_default</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">hc</span> <span class="o">*</span> <span class="n">hrss</span> <span class="o">/</span> <span class="n">hrss_default</span>

        <span class="c1"># ---- Applying inclination factors, assuming l=|m|=2 mode</span>
        <span class="c1">#      dominates the emission.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ciota</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">ciota</span> <span class="o">*</span> <span class="n">hc</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;marek09&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Marek 2009 supernova matter waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;methodspaper&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- A set of four numerical waveforms to be included in the</span>
        <span class="c1">#      supernova methods paper. See also Table 3 of the review</span>
        <span class="c1">#      http://arxiv.org/abs/1110.5107v2. The names are</span>
        <span class="c1">#      gw_s15s7b2.dat, sasi3DL68randgwraynew_thphcPole,</span>
        <span class="c1">#      polar_R4E1FC_L and TK11_B12X1B01.</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>


        <span class="c1"># ---- Waveforms have a default distance of 10 kpc.  Rescale if</span>
        <span class="c1">#      desired.  For historical reasons, distance = 0 is treated as</span>
        <span class="c1">#      the default of 10 kpc.</span>
        <span class="k">if</span> <span class="n">distance</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
            <span class="n">hc</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;morozova2018&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Burrows 2018 2D SN waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 1cm.</span>
        <span class="c1">#      therefore we convert it first to 1 kpc then divide</span>
        <span class="c1">#      through by provided distance</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mono&#39;</span><span class="p">,</span> <span class="s1">&#39;mono-a&#39;</span><span class="p">,</span> <span class="s1">&#39;mono-b&#39;</span><span class="p">,</span> <span class="s1">&#39;mono-c&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;line-a&#39;</span><span class="p">,</span> <span class="s1">&#39;line-b&#39;</span><span class="p">,</span> <span class="s1">&#39;quad-a&#39;</span><span class="p">,</span> <span class="s1">&#39;quad-b&#39;</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # ---- Long-duration sine waves used by STAMP-AS. See</span>
<span class="sd">        #      https://wiki.ligo.org/Main/O1analysisInjections (date: 2016.03.05).</span>
<span class="sd">        #        parameters(1) - hrss</span>
<span class="sd">        #        parameters(2) - tau (duration) - OPTIONAL</span>
<span class="sd">        #        parameters(3) - f0 (start frequency) - OPTIONAL</span>
<span class="sd">        #        parameters(4) - fp0 (frequency derivative) - OPTIONAL</span>
<span class="sd">        #        parameters(5) - fpp0 (frequency second derivative) - OPTIONAL</span>
<span class="sd">        h_rss = parameters[0]</span>
<span class="sd">        # ---- Default parameters: zero frequency derivatives.</span>
<span class="sd">        fp0  = 0</span>
<span class="sd">        fpp0 = 0</span>
<span class="sd">        if family.lower() == &#39;mono&#39;:</span>
<span class="sd">            tau = parameters[1]</span>
<span class="sd">            f0 = parameters[2]</span>
<span class="sd">            if len(parameters)&gt;=4:</span>
<span class="sd">                fp0 = parameters[3]</span>

<span class="sd">            if len(parameters)&gt;=5:</span>
<span class="sd">                fpp0 = parameters[4]</span>

<span class="sd">        # ---- Special cases with hardwired parameters.</span>
<span class="sd">        elif family.lower() == &#39;mono-a&#39;:</span>
<span class="sd">            tau = 150</span>
<span class="sd">            f0  = 90</span>
<span class="sd">        elif family.lower() == &#39;mono-b&#39;:</span>
<span class="sd">            tau = 250</span>
<span class="sd">            f0  = 550</span>
<span class="sd">        elif family.lower() == &#39;mono-c&#39;:</span>
<span class="sd">            tau = 250</span>
<span class="sd">            f0  = 405</span>
<span class="sd">        elif family.lower() == &#39;line-a&#39;:</span>
<span class="sd">            tau = 250</span>
<span class="sd">            f0  = 50</span>
<span class="sd">            fp0 = 0.6</span>
<span class="sd">        elif family.lower() == &#39;line-b&#39;:</span>
<span class="sd">            tau = 100</span>
<span class="sd">            f0  = 900</span>
<span class="sd">            fp0 = -2</span>
<span class="sd">        elif family.lower() == &#39;quad-a&#39;:</span>
<span class="sd">            tau =  30</span>
<span class="sd">            f0  =  50</span>
<span class="sd">            fp0 =  0</span>
<span class="sd">            fpp0 = 1./3</span>
<span class="sd">        elif family.lower() == &#39;quad-b&#39;:</span>
<span class="sd">            tau =  70</span>
<span class="sd">            f0  =  500</span>
<span class="sd">            fp0 =  0</span>
<span class="sd">            fpp0 = 0.041</span>

<span class="sd">        # ---- Sanity checks: these are meant to be long-duration injections.</span>
<span class="sd">        if tau &lt; 2:</span>
<span class="sd">            warnings.warn(&#39;Injection shorter than 2 seconds. &#39;</span>
<span class="sd">                          &#39;Tapering may give unexpected behaviour.&#39;)</span>

<span class="sd">        # ---- Linearly polarised sine wave with frequency f(t) starting at time</span>
<span class="sd">        #      t=0. The frequency is defined as</span>
<span class="sd">        #        f(t)   = f0 + (df/dt)*t + (1/2)*(d^2f/dt^2)*t^2</span>
<span class="sd">        #      t=0. Therefore the phase will be</span>
<span class="sd">        #        Phi(t) = 2 * pi * \int_0^t dt f(t)</span>
<span class="sd">        #               = 2 * pi * \int_0^t dt [f0 + (df/dt)*t + (1/2)*(d^2f/dt^2)*t^2]</span>
<span class="sd">        #               = 2 * pi * [f0 t + (df/dt)*t^2/2 + (1/2)*(d^2f/dt^2)*t^3/3]</span>
<span class="sd">        t_temp = numpy.arange(0, tau, 1./fs)</span>
<span class="sd">        hp_temp = numpy.sin(2 * numpy.pi * (f0 * t_temp +</span>
<span class="sd">                                            1./2 * fp0 * t_temp**2 +</span>
<span class="sd">                                            1./6 * fpp0 * t_temp**3))</span>

<span class="sd">        # ---- Use Hann window to taper the ends of the waveform.</span>
<span class="sd">        window = scipy.signal.hanning(2*fs)</span>
<span class="sd">        hp_temp(0:fs) = hp_temp([1:1:fs]) .* window(1:fs)</span>
<span class="sd">        hp_temp([end-fs+1:end]) = hp_temp([end-fs+1:1:end]) .* window(fs+1:end)</span>

<span class="sd">        # ---- Rescale to the desired h_rss.</span>
<span class="sd">        hrss_norm = (numpy.sum(hp_temp**2)/fs)**0.5</span>
<span class="sd">        hp = hp_temp * h_rss/hrss_norm</span>

<span class="sd">        # ---- Define cross and scalar-mode components to be zero.</span>
<span class="sd">        hc = zeros(size(hp))</span>
<span class="sd">        hb = zeros(size(hp))</span>

<span class="sd">        # ---- Turn on interpolation to handle time-shifting of waveform to</span>
<span class="sd">        #      desired peak time.</span>
<span class="sd">        pregen = 1</span>
<span class="sd">        pregen_fs = fs</span>
<span class="sd">        pregen_T = tau</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mvp&#39;</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # ----  van Putten based waveform model (pregenerated).</span>
<span class="sd">        pregen = 1</span>
<span class="sd">        pregen_fs = 16384</span>
<span class="sd">        pregen_T = 30</span>

<span class="sd">        # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">        if (isempty(catalog))</span>
<span class="sd">            # disp(&#39;Loading MvP catalog.&#39;)</span>
<span class="sd">            load([filedir &#39;MvPcat.mat&#39;])</span>
<span class="sd">        end</span>

<span class="sd">        # ---- Find specified waveform type.</span>
<span class="sd">        NAME = parameters{1,2}</span>
<span class="sd">        for k=1:length(MvPcat)</span>
<span class="sd">            if (strcmp(MvPcat(k).name,NAME))</span>
<span class="sd">                wf_number = k</span>
<span class="sd">            end</span>
<span class="sd">        end</span>

<span class="sd">        # ---- Read waveform, which is defined at a range of 10kpc.</span>
<span class="sd">        #      Make sure h is same type of vector (column) as t.</span>
<span class="sd">        distance = 0.1*parameters{1}</span>
<span class="sd">        # note: if these are read in from column ascii files, no need to invert vector dims</span>
<span class="sd">        hp = 1./distance*MvPcat(wf_number).hp</span>
<span class="sd">        hc = 1./distance*MvPcat(wf_number).hc</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ncsa-cam&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- These waveforms are generated with the NCSA-CAM waveform</span>
        <span class="c1">#      model. The main features of the model are summarized in the</span>
        <span class="c1">#      DCC document https://dcc.ligo.org/DocDB/0140/G1700265/001/ecc_presentation.pdf</span>
        <span class="c1">#      The files present waveforms describing BNS systems with mass</span>
        <span class="c1">#      combinations [1.4, 1.4] and [3, 3] solar masses,</span>
        <span class="c1">#      eccentricities of 0.2, 0.4, or 0.6, and located at a</span>
        <span class="c1">#      luminosity distance of 100 mpc. The waveforms are generated</span>
        <span class="c1">#      from an initial gravitational wave frequency of 15Hz.</span>

        <span class="c1"># ---- Each cell array entry holds an Nx2 array with columns</span>
        <span class="c1">#      [h_plus(t), h_cross(t)] for one of the six waveforms. Each</span>
        <span class="c1">#      waveform is sampled at 16384 samples per second. The</span>
        <span class="c1">#      waveform parameters are:</span>
        <span class="c1">#       1  m1=m2=1.4Msun, ecc=0.2</span>
        <span class="c1">#       2  m1=m2=1.4Msun, ecc=0.4</span>
        <span class="c1">#       3  m1=m2=1.4Msun, ecc=0.6</span>
        <span class="c1">#       4  m1=m2=3Msun, ecc=0.2</span>
        <span class="c1">#       5  m1=m2=3Msun, ecc=0.4</span>
        <span class="c1">#       6  m1=m2=3Msun, ecc=0.6</span>

        <span class="c1"># ---- Parameters.</span>
        <span class="n">mass</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ecc</span>   <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ciota</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">dist</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="c1"># ---- Select desired waveform.</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass1.4_ecc0.2&#39;</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass1.4_ecc0.4&#39;</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass1.4_ecc0.6&#39;</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass3.0_ecc0.2&#39;</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass3.0_ecc0.4&#39;</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">mass</span><span class="p">,</span> <span class="n">ecc</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;mass3.0_ecc0.6&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mass, ecc values not an allowed pair&#39;</span><span class="p">)</span>

        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Extract waveforms and rescale as needed.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">/</span><span class="n">dist</span> <span class="o">*</span> <span class="n">hp</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ciota</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">/</span><span class="n">dist</span> <span class="o">*</span> <span class="n">hc</span> <span class="o">*</span> <span class="n">ciota</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;oconnorcouch2018&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Burrows 2018 2D SN waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 1 kiloparsec.</span>
        <span class="c1"># and scale by distance (distance should be in kiloparsecs)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;onecyclesine&#39;</span><span class="p">]:</span>

        <span class="c1"># ---- One cycle of a sine wave.</span>
        <span class="n">h_peak</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">h_peak</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span><span class="p">),</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;onecyclesine&#39;</span>
                       <span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">f0</span><span class="p">))</span>
        <span class="n">hp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Turn off default interpolation (symmetric ad hoc waveform).</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;osnsearch&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Entry from one of various waveform catalogs (pregenerated).</span>
        <span class="c1">#       The waveforms in this catalog are of different lengths, but</span>
        <span class="c1">#       have the same sampling rate.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># ---- Find specified waveform type.</span>
        <span class="n">hrssp</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hrssc</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">name</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ---- Read waveform.  Each has its own defined hrss for each</span>
        <span class="c1">#      polarisation.  First check for consistent hrss values.</span>
        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">hrssp</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                                     <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">hrssc</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                                     <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;o1snews&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Entry from one of various waveform catalogs (pregenerated).</span>
        <span class="c1">#       The waveforms in this catalog are of different lengths, but</span>
        <span class="c1">#       have the same sampling rate.</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># ---- Find specified waveform type.</span>
        <span class="n">hrssp</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hrssc</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">name</span>  <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ---- Read waveform.  Each has its own defined hrss for each</span>
        <span class="c1">#      polarisation.  First check for consistent hrss values.</span>
        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">hrssp</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                                     <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">hrssc</span> <span class="o">*</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                                     <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ott09&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Marek 2009 supernova matter waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ott10&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Dimmelmeier, Font, and Mueller supernova waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>


        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pca&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Marek 2009 supernova matter waveform (pregenerated).</span>
        <span class="n">hrss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 10kpc.</span>
        <span class="c1">#      Make sure h is same type of vector (column) as t.</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pmns_pca&#39;</span><span class="p">]:</span>


        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="n">hp</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">hc</span> <span class="o">/</span> <span class="p">(</span><span class="n">distance</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;powell2018&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Burrows 2018 2D SN waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 1 kiloparsec.</span>
        <span class="c1"># and scale by distance (distance should be in kiloparsecs)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;yakunin2017&#39;</span><span class="p">]:</span>

        <span class="c1"># ----  Burrows 2018 2D SN waveform (pregenerated).</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Read hplus</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filedir</span><span class="p">,</span> <span class="n">family</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span><span class="p">),</span>
                             <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/</span><span class="si">{0}</span><span class="s1">/</span><span class="si">{1}</span><span class="s1">/hc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


        <span class="n">pregen_fs</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span>
        <span class="n">pregen_T</span> <span class="o">=</span> <span class="n">hp</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># ---- Read waveform, which is defined at a range of 1 kiloparsec.</span>
        <span class="c1"># and scale by distance (distance should be in kiloparsecs)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">hc</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scalarchirplet&#39;</span><span class="p">]:</span>

        <span class="n">h_rss</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># ---- Optional parameters.</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ciota</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">ciota</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1"># ---- Waveform.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h_rss</span> <span class="o">*</span> <span class="p">(</span>
                     <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                              <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span>
                              <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                              <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T0</span><span class="p">)</span> <span class="o">*</span><span class="n">f0</span>
                              <span class="o">+</span> <span class="n">sqrt_of_neg_1</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                     <span class="o">/</span>
                     <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">family</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="n">hc</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hb</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hb</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">hb</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># ---- Turn off default interpolation (ad hoc waveform is designed</span>
        <span class="c1">#      to produce desired T0).</span>
        <span class="n">pregen</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        elif family.lower() in [&#39;scalarsn&#39;]:</span>
<span class="sd">                # ---- Ibanez and Novak scalar-mode gravitational</span>
<span class="sd">                #      collapse waveform (pregenerated).</span>

<span class="sd">                # ---- Model type and parameters.</span>
<span class="sd">                model    = parameters[0]</span>
<span class="sd">                distance = parameters[1]</span>
<span class="sd">                newalpha    = parameters[2]</span>

<span class="sd">                # ---- Pre-sampled waveform.  Columns: time [s], strain [unitless].</span>
<span class="sd">                #      For model details on each model look Tabel 1 of</span>
<span class="sd">                #      http://stacks.iop.org/0004-637X/533/i=1/a=392.</span>
<span class="sd">                if strcmpi(model,&#39;A&#39;)</span>
<span class="sd">                    alphadefault = 0.01</span>
<span class="sd">                    data = [ ...</span>
<span class="sd">                        2.0038910505836576 -92.51101321585884...</span>
<span class="sd">                        2.953307392996109 -88.10572687224658...</span>
<span class="sd">                        3.1089494163424125 -88.10572687224658...</span>
<span class="sd">                        3.264591439688716 -79.29515418502183...</span>
<span class="sd">                        3.3813229571984436 -79.29515418502183...</span>
<span class="sd">                        3.498054474708171 -66.07929515418482...</span>
<span class="sd">                        3.583657587548638 -52.86343612334804...</span>
<span class="sd">                        3.6692607003891053 -35.24229074889854...</span>
<span class="sd">                        3.7237354085603114 -17.62114537444927...</span>
<span class="sd">                        3.7782101167315174 4.405286343612488...</span>
<span class="sd">                        3.8326848249027234 35.24229074889877...</span>
<span class="sd">                        3.8949416342412455 79.29515418502206...</span>
<span class="sd">                        3.9338521400778212 114.53744493392082...</span>
<span class="sd">                        3.9961089494163424 189.4273127753304...</span>
<span class="sd">                        4.073929961089494 308.3700440528635...</span>
<span class="sd">                        4.143968871595331 449.3392070484581...</span>
<span class="sd">                        4.198443579766537 607.9295154185022...</span>
<span class="sd">                        4.276264591439689 828.193832599119...</span>
<span class="sd">                        4.33852140077821 1026.431718061674...</span>
<span class="sd">                        4.392996108949417 1149.7797356828194...</span>
<span class="sd">                        4.439688715953308 1220.2643171806167...</span>
<span class="sd">                        4.470817120622568 1251.101321585903...</span>
<span class="sd">                        4.517509727626459 1277.533039647577...</span>
<span class="sd">                        4.571984435797665 1290.748898678414...</span>
<span class="sd">                        4.626459143968872 1290.748898678414...</span>
<span class="sd">                        4.696498054474708 1281.9383259911895...</span>
<span class="sd">                        4.735408560311284 1264.3171806167402...</span>
<span class="sd">                        4.797665369649805 1255.5066079295154...</span>
<span class="sd">                        4.875486381322958 1246.6960352422907...</span>
<span class="sd">                        4.976653696498055 1246.6960352422907...</span>
<span class="sd">                        5.085603112840467 1246.6960352422907...</span>
<span class="sd">                        5.186770428015564 1237.8854625550662...</span>
<span class="sd">                        5.373540856031129 1242.2907488986784...</span>
<span class="sd">                        5.575875486381324 1237.8854625550662...</span>
<span class="sd">                        5.747081712062257 1246.6960352422907...</span>
<span class="sd">                        5.8404669260700395 1242.2907488986784]</span>

<span class="sd">                elseif strcmpi(model,&#39;B&#39;)</span>
<span class="sd">                    alphadefault = 0.004</span>
<span class="sd">                    data = [ ...</span>
<span class="sd">              TimeSeries          0.017094017094017144 509.0909090909091...</span>
<span class="sd">                        0.8974358974358977 509.0909090909091...</span>
<span class="sd">                        1.0683760683760686 509.0909090909091...</span>
<span class="sd">                        1.2136752136752138 509.0909090909091...</span>
<span class="sd">                        1.3162393162393164 506.06060606060606...</span>
<span class="sd">                        1.4615384615384617 503.030303030303...</span>
<span class="sd">                        1.5384615384615388 500.0...</span>
<span class="sd">                        1.6495726495726495 490.9090909090909...</span>
<span class="sd">                        1.717948717948718 481.8181818181818...</span>
<span class="sd">                        1.7863247863247866 469.69696969696975...</span>
<span class="sd">                        1.8461538461538463 451.5151515151515...</span>
<span class="sd">                        1.9145299145299148 421.21212121212125...</span>
<span class="sd">                        1.9572649572649574 396.969696969697...</span>
<span class="sd">                        2.0085470085470085 363.6363636363636...</span>
<span class="sd">                        2.0512820512820515 306.06060606060606...</span>
<span class="sd">                        2.0854700854700856 263.6363636363636...</span>
<span class="sd">                        2.1196581196581197 203.03030303030306...</span>
<span class="sd">                        2.1623931623931627 133.33333333333337...</span>
<span class="sd">                        2.1880341880341883 81.81818181818187...</span>
<span class="sd">                        2.213675213675214 30.30303030303037...</span>
<span class="sd">                        2.247863247863248 -15.151515151515127...</span>
<span class="sd">                        2.2820512820512824 -48.4848484848485...</span>
<span class="sd">                        2.3162393162393164 -63.636363636363626...</span>
<span class="sd">                        2.3504273504273505 -57.57575757575751...</span>
<span class="sd">                        2.3931623931623935 -39.39393939393938...</span>
<span class="sd">                        2.4444444444444446 -18.18181818181813...</span>
<span class="sd">                        2.4957264957264957 -6.0606060606060055...</span>
<span class="sd">                        2.5384615384615388 3.0303030303030027...</span>
<span class="sd">                        2.717948717948718 3.0303030303030027...</span>
<span class="sd">                        2.7521367521367526 3.0303030303030027]</span>

<span class="sd">                elseif strcmpi(model,&#39;C&#39;)</span>
<span class="sd">                    alphadefault = 0.01</span>
<span class="sd">                    data = [...</span>
<span class="sd">                        69.2929292929293 21.333333333333336  ...</span>
<span class="sd">                        69.4949494949495 21.333333333333336  ...</span>
<span class="sd">                        69.72222222222223 21.333333333333336  ...</span>
<span class="sd">                        69.97474747474747 21.333333333333336  ...</span>
<span class="sd">                        70.25252525252526 21.333333333333336  ...</span>
<span class="sd">                        70.5050505050505 21.393939393939394  ...</span>
<span class="sd">                        70.8838383838384 21.393939393939394  ...</span>
<span class="sd">                        71.23737373737374 21.393939393939394  ...</span>
<span class="sd">                        71.74242424242425 21.393939393939394  ...</span>
<span class="sd">                        72.2979797979798 21.515151515151516  ...</span>
<span class="sd">                        72.77777777777779 21.515151515151516  ...</span>
<span class="sd">                        73.15656565656566 21.575757575757578  ...</span>
<span class="sd">                        73.66161616161617 21.636363636363637  ...</span>
<span class="sd">                        74.11616161616162 21.636363636363637  ...</span>
<span class="sd">                        74.64646464646465 21.6969696969697  ...</span>
<span class="sd">                        75.22727272727273 21.75757575757576  ...</span>
<span class="sd">                        75.85858585858587 21.81818181818182  ...</span>
<span class="sd">                        76.5909090909091 21.93939393939394  ...</span>
<span class="sd">                        77.52525252525253 22.060606060606062  ...</span>
<span class="sd">                        78.51010101010101 22.303030303030305  ...</span>
<span class="sd">                        79.57070707070707 22.666666666666668  ...</span>
<span class="sd">                        80.42929292929293 23.272727272727273  ...</span>
<span class="sd">                        80.83333333333334 23.6969696969697  ...</span>
<span class="sd">                        81.03535353535354 24.121212121212125  ...</span>
<span class="sd">                        81.23737373737374 24.72727272727273  ...</span>
<span class="sd">                        81.43939393939394 25.63636363636364  ...</span>
<span class="sd">                        81.64141414141415 27.090909090909093  ...</span>
<span class="sd">                        81.76767676767678 28.969696969696972  ...</span>
<span class="sd">                        81.86868686868688 31.212121212121215  ...</span>
<span class="sd">                        81.96969696969697 33.45454545454545  ...</span>
<span class="sd">                        81.9949494949495 36.0  ...</span>
<span class="sd">                        82.04545454545455 39.333333333333336  ...</span>
<span class="sd">                        82.0959595959596 42.24242424242424  ...</span>
<span class="sd">                        82.12121212121212 43.27272727272727  ...</span>
<span class="sd">                        82.24747474747475 46.909090909090914  ...</span>
<span class="sd">                        82.42424242424244 42.54545454545455  ...</span>
<span class="sd">                        82.57575757575758 40.0  ...</span>
<span class="sd">                        82.70202020202021 38.78787878787879  ...</span>
<span class="sd">                        82.85353535353536 39.57575757575758  ...</span>
<span class="sd">                        82.95454545454547 39.93939393939394  ...</span>
<span class="sd">                        83.13131313131314 39.45454545454545  ...</span>
<span class="sd">                        83.28282828282829 39.21212121212122  ...</span>
<span class="sd">                        83.56060606060606 38.484848484848484  ...</span>
<span class="sd">                        83.7878787878788 38.66666666666667  ...</span>
<span class="sd">                        83.88888888888889 38.60606060606061  ...</span>
<span class="sd">                        84.04040404040404 38.121212121212125  ...</span>
<span class="sd">                        84.1919191919192 38.0  ...</span>
<span class="sd">                        84.31818181818183 37.87878787878788  ...</span>
<span class="sd">                        84.4949494949495 37.81818181818182  ...</span>
<span class="sd">                        84.62121212121212 37.93939393939394  ...</span>
<span class="sd">                        84.84848484848486 37.75757575757576  ...</span>
<span class="sd">                        85.02525252525253 37.6969696969697  ...</span>
<span class="sd">                        85.12626262626263 37.75757575757576  ...</span>
<span class="sd">                        85.30303030303031 37.515151515151516  ...</span>
<span class="sd">                        85.8838383838384 37.3939393939394  ...</span>
<span class="sd">                        86.41414141414143 37.151515151515156  ...</span>
<span class="sd">                        86.61616161616162 37.27272727272727  ...</span>
<span class="sd">                        86.84343434343435 36.96969696969697  ...</span>
<span class="sd">                        87.14646464646465 37.151515151515156  ...</span>
<span class="sd">                        87.2979797979798 37.151515151515156  ...</span>
<span class="sd">                        87.57575757575758 37.151515151515156  ...</span>
<span class="sd">                        87.87878787878788 36.909090909090914]</span>

<span class="sd">                elseif strcmpi(model,&#39;D&#39;)</span>
<span class="sd">                    alphadefault = 0.01</span>
<span class="sd">                    data = [ ...</span>
<span class="sd">                        76.26666666666667 21.627906976744185  ...</span>
<span class="sd">                        78.26666666666667 22.093023255813947  ...</span>
<span class="sd">                        79.48333333333333 22.558139534883722  ...</span>
<span class="sd">                        80.31666666666666 23.023255813953483  ...</span>
<span class="sd">                        80.75 23.720930232558132  ...</span>
<span class="sd">                        81.01666666666667 24.186046511627907  ...</span>
<span class="sd">                        81.26666666666667 24.65116279069767  ...</span>
<span class="sd">                        81.5 25.581395348837205  ...</span>
<span class="sd">                        81.7 27.441860465116278  ...</span>
<span class="sd">                        81.81666666666666 30.0  ...</span>
<span class="sd">                        81.9 33.25581395348837  ...</span>
<span class="sd">                        81.98333333333333 40.69767441860465  ...</span>
<span class="sd">                        82.06666666666666 52.790697674418595  ...</span>
<span class="sd">                        82.13333333333334 41.16279069767441  ...</span>
<span class="sd">                        82.15 31.860465116279073  ...</span>
<span class="sd">                        82.18333333333334 23.720930232558132  ...</span>
<span class="sd">                        82.25 30.69767441860465 ...</span>
<span class="sd">                        82.28333333333333 35.81395348837209  ...</span>
<span class="sd">                        82.31666666666666 44.18604651162791  ...</span>
<span class="sd">                        82.33333333333334 52.09302325581395  ...</span>
<span class="sd">                        82.38333333333334 63.72093023255813  ...</span>
<span class="sd">                        82.43333333333334 73.02325581395348  ...</span>
<span class="sd">                        82.5 80.69767441860465  ...</span>
<span class="sd">                        82.56666666666666 90.93023255813952  ...</span>
<span class="sd">                        82.66666666666667 101.62790697674419  ...</span>
<span class="sd">                        82.73333333333333 108.13953488372093  ...</span>
<span class="sd">                        82.81666666666666 112.55813953488372  ...</span>
<span class="sd">                        82.88333333333334 115.81395348837209  ...</span>
<span class="sd">                        82.95 118.37209302325581  ...</span>
<span class="sd">                        83.1 120.23255813953487  ...</span>
<span class="sd">                        83.23333333333333 120.93023255813954  ...</span>
<span class="sd">                        83.51666666666667 119.76744186046511  ...</span>
<span class="sd">                        83.71666666666667 118.13953488372093  ...</span>
<span class="sd">                        83.95 116.9767441860465  ...</span>
<span class="sd">                        84.23333333333333 115.81395348837209  ...</span>
<span class="sd">                        84.5 115.34883720930232  ...</span>
<span class="sd">                        84.9 113.72093023255813  ...</span>
<span class="sd">                        85.38333333333334 112.55813953488372  ...</span>
<span class="sd">                        85.88333333333334 111.62790697674419  ...</span>
<span class="sd">                        86.35 110.93023255813952  ...</span>
<span class="sd">                        86.66666666666667 110.69767441860465  ...</span>
<span class="sd">                        86.96666666666667 110.23255813953489  ...</span>
<span class="sd">                        87.13333333333334 110.23255813953489  ...</span>
<span class="sd">                        87.71666666666667 110.0  ...</span>
<span class="sd">                        88.15 109.30232558139534  ...</span>
<span class="sd">                        88.43333333333334 109.30232558139534]</span>

<span class="sd">                elseif strcmpi(model,&#39;E&#39;)</span>
<span class="sd">                    alphadefault = 0.001</span>
<span class="sd">                    data = [ ...</span>
<span class="sd">                        69.33920704845815 0.0  ...</span>
<span class="sd">                        71.01321585903084 0.0  ...</span>
<span class="sd">                        72.99559471365639 0.0  ...</span>
<span class="sd">                        75.0 0.0  ...</span>
<span class="sd">                        76.98237885462555 0.0  ...</span>
<span class="sd">                        78.98678414096916 0.0  ...</span>
<span class="sd">                        80.99118942731278 0.0  ...</span>
<span class="sd">                        81.87224669603525 3.9603960396040065 ...</span>
<span class="sd">                        81.98237885462555 5.940594059405953  ...</span>
<span class="sd">                        82.0704845814978 13.861386138613852  ...</span>
<span class="sd">                        82.11453744493393 25.74257425742576  ...</span>
<span class="sd">                        82.18061674008811 39.60396039603961  ...</span>
<span class="sd">                        82.31277533039648 99.00990099009903  ...</span>
<span class="sd">                        82.5330396475771 215.8415841584159  ...</span>
<span class="sd">                        82.73127753303964 314.8514851485148  ...</span>
<span class="sd">                        82.9295154185022 481.1881188118812  ...</span>
<span class="sd">                        83.10572687224669 671.2871287128713  ...</span>
<span class="sd">                        83.17180616740089 752.4752475247525  ...</span>
<span class="sd">                        83.23788546255507 807.9207920792079  ...</span>
<span class="sd">                        83.32599118942731 829.7029702970298  ...</span>
<span class="sd">                        83.50220264317181 819.8019801980198  ...</span>
<span class="sd">                        83.6784140969163 841.5841584158416  ...</span>
<span class="sd">                        83.89867841409692 819.8019801980198  ...</span>
<span class="sd">                        84.11894273127754 833.6633663366337  ...</span>
<span class="sd">                        84.33920704845815 819.8019801980198  ...</span>
<span class="sd">                        84.49339207048459 827.7227722772277  ...</span>
<span class="sd">                        84.75770925110132 817.8217821782179 ...</span>
<span class="sd">                        84.86784140969164 825.7425742574258  ...</span>
<span class="sd">                        85.11013215859032 817.8217821782179  ...</span>
<span class="sd">                        85.48458149779736 817.8217821782179]</span>

<span class="sd">                else</span>

<span class="sd">                    error([&#39;Model &#39; model &#39; unknown.&#39;])</span>

<span class="sd">                end</span>

<span class="sd">            # ---- Catalog time is in milliseconds convert to seconds.</span>
<span class="sd">            time = data(:,1)/1000</span>
<span class="sd">            # Normalize to 1Kpc then let user specify distance (in Kpc)</span>
<span class="sd">            # Also multiply the strain by 1 over user specified omega coupling</span>
<span class="sd">            # paramters</span>
<span class="sd">            strain = data(:,2)*(1000/megaparsec_meters)*(1/distance)*...</span>
<span class="sd">            (newalpha/alphadefault)</span>

<span class="sd">            # ---- Attached smooth tapers to start and end.</span>
<span class="sd">            pregen = 1</span>
<span class="sd">            pregen_fs = 16384</span>
<span class="sd">            pregen_T = 1.0</span>
<span class="sd">            Nsamp = round(pregen_fs * pregen_T)</span>
<span class="sd">            t_all = [0:(Nsamp-1)].T * 1/pregen_fs</span>
<span class="sd">            time =  time + (0.5*pregen_T-time(1))</span>
<span class="sd">            # ---- Time samples before, during, and after pre-generated waveform.</span>
<span class="sd">            index_start = find(t_all&lt;time(1))</span>
<span class="sd">            index_mid   = find(t_all&gt;=time(1) &amp; t_all&lt;=time(end))</span>
<span class="sd">            index_end   = find(t_all&gt;time(end))</span>

<span class="sd">            Fc = 1/pregen_T    # Hertz of windowing</span>
<span class="sd">            window = zeros(size(t_all))</span>
<span class="sd">            # ---- Interpolate pre-generated waveform to regularly sampled time</span>
<span class="sd">            #      samples.</span>
<span class="sd">            window(index_mid) = interp1(time,strain,t_all(index_mid))</span>
<span class="sd">            # ---- Attach smoothly varying sinusoid to start to avoid discontinuities.</span>
<span class="sd">            window(index_start) = (1 - cos(2*pi*Fc*t_all(index_start)))</span>
<span class="sd">            window(index_start) = window(index_start) * (window(index_mid(1))/window(index_start(end)))</span>
<span class="sd">            # ---- Attach smoothly varying sinusoid to end to avoid discontinuities.</span>
<span class="sd">            window(index_end) = (1 - cos(2*pi*Fc*t_all(index_end)))</span>
<span class="sd">            window(index_end) = window(index_end) * (window(index_mid(end))/window(index_end(1)))</span>

<span class="sd">            hb = window</span>
<span class="sd">            t_resamp = t_all</span>
<span class="sd">            hp = zeros(size(hb))</span>
<span class="sd">            hc = zeros(size(hb))</span>

<span class="sd">        elif family.lower() in [&#39;scheide&#39;, &#39;scheidp&#39;]:</span>

<span class="sd">                # ---- This is Scheidegger 2010 waveform for equatorial (e) or</span>
<span class="sd">                #      polar (p) observer.  Read pregenerated supernova catalog.</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = 8192</span>
<span class="sd">                pregen_T = 0.5</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    load([filedir &#39;Scheidcat.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Find specified waveform type.</span>
<span class="sd">                NAME = parameters{1,2}</span>
<span class="sd">                for k=1:length(Scheidcat)</span>
<span class="sd">                    if (strcmp(Scheidcat(k).name,NAME))</span>
<span class="sd">                        index = k</span>
<span class="sd">                    end</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Read waveform, which is defined at a range of 10kpc.</span>
<span class="sd">                #      Make sure h is same type of vector (column) as t.</span>
<span class="sd">                switch lower(type)</span>
<span class="sd">                    case &#39;scheide&#39;</span>
<span class="sd">                        hp = 10/parameters{1} * Scheidcat(index).hpe</span>
<span class="sd">                        hc = 10/parameters{1} * Scheidcat(index).hce</span>
<span class="sd">                    case &#39;scheidp&#39;</span>
<span class="sd">                        hp = 10/parameters{1} * Scheidcat(index).hpp</span>
<span class="sd">                        hc = 10/parameters{1} * Scheidcat(index).hcp</span>
<span class="sd">                end</span>

<span class="sd">        elif family.lower() in [&#39;sg&#39;]:</span>

<span class="sd">                # ---- sine-Gaussians</span>
<span class="sd">                h_rss = parameters(1)</span>
<span class="sd">                Q = parameters(2)</span>
<span class="sd">                f0 = parameters(3)</span>
<span class="sd">                h_peak = h_rss * ((4 * pi^0.5 * f0)/(Q * (1-exp(-Q^2))))^0.5</span>
<span class="sd">                tau = Q / (2^0.5 * pi * f0)</span>
<span class="sd">                hp = h_peak*sin(2*pi*(t-T0)*f0).*exp(-(t-T0).^2./tau.^2)</span>
<span class="sd">                hc = zeros(size(hp))</span>

<span class="sd">                # ---- Turn off default interpolation (symmetric ad hoc waveform).</span>
<span class="sd">                pregen = 0</span>

<span class="sd">        elif family.lower() in [&#39;snmp&#39;]:</span>

<span class="sd">                # ----  Entry from one of various waveform catalogs (pregenerated).</span>
<span class="sd">                #       The waveforms in this catalog are of different lengths, but</span>
<span class="sd">                #       have the same sampling rate.</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = 16384</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    catalog = load([filedir lower(type) &#39;.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Find specified waveform type.</span>
<span class="sd">                hrssp = parameters{1,1}</span>
<span class="sd">                hrssc = parameters{1,2}</span>
<span class="sd">                NAME  = parameters{1,3}</span>
<span class="sd">                index = find(strcmpi(catalog.name,NAME))</span>

<span class="sd">                # ---- Read waveform.  Each has its own defined hrss for each</span>
<span class="sd">                #      polarisation.  First check for consistent hrss values.</span>
<span class="sd">                if (catalog.hrssp(index)==0 &amp; hrssp~=0)</span>
<span class="sd">                    error(&#39;Requested waveform has zero amplitude for plus polarisation.&#39;)</span>
<span class="sd">                end</span>
<span class="sd">                if (catalog.hrssc(index)==0 &amp; hrssc~=0)</span>
<span class="sd">                    error(&#39;Requested waveform has zero amplitude for cross polarisation.&#39;)</span>
<span class="sd">                end</span>
<span class="sd">                if (catalog.hrssp(index)&gt;0)</span>
<span class="sd">                    hp = (hrssp/catalog.hrssp(index))*catalog.hp{index}</span>
<span class="sd">                else</span>
<span class="sd">                    hp = catalog.hp{index}  #-- zero waveform</span>
<span class="sd">                end</span>
<span class="sd">                if (catalog.hrssc(index)&gt;0)</span>
<span class="sd">                    hc = (hrssc/catalog.hrssc(index))*catalog.hc{index}</span>
<span class="sd">                else</span>
<span class="sd">                    hc = catalog.hc{index}  #-- zero waveform</span>
<span class="sd">                end</span>

<span class="sd">                pregen_T = length(hp)/pregen_fs</span>

<span class="sd">        elif family.lower() in [&#39;snn94&#39;]:</span>

<span class="sd">                # ---- Shibata, Nakao, and Nakamura scalar-mode gravitational</span>
<span class="sd">                #      collapse waveform (pregenerated).</span>

<span class="sd">                # ---- Model type and parameters.</span>
<span class="sd">                model = parameters{1}</span>
<span class="sd">                mass = parameters{2}</span>
<span class="sd">                distance = parameters{3}</span>
<span class="sd">                alphanew = parameters{4}</span>

<span class="sd">                # ---- Pre-sampled waveform.  Columns: time [s], strain [unitless].</span>
<span class="sd">                #      This data if for a 10 Msun BH at 10 mpc.</span>
<span class="sd">                if strcmpi(model,&#39;a1&#39;)</span>
<span class="sd">                    alphadefault = 0.0316</span>
<span class="sd">                    data = np.array([ ...</span>
<span class="sd">                        0, 0,</span>
<span class="sd">                        0.00327733, 0  ...</span>
<span class="sd">                        0.00579835, 0  ...</span>
<span class="sd">                        0.00593841, 3.45745e-24  ...</span>
<span class="sd">                        0.00613449, 1.40957e-23  ...</span>
<span class="sd">                        0.00630256, 2.73936e-23  ...</span>
<span class="sd">                        0.00644261, 3.96277e-23  ...</span>
<span class="sd">                        0.00661068, 5.50532e-23  ...</span>
<span class="sd">                        0.00672273, 6.70213e-23  ...</span>
<span class="sd">                        0.00686278, 7.84574e-23  ...</span>
<span class="sd">                        0.00705886, 9.09574e-23  ...</span>
<span class="sd">                        0.00728295, 9.94681e-23  ...</span>
<span class="sd">                        0.007395, 1.01596e-22  ...</span>
<span class="sd">                        0.00778716 9.9734e-23  ...</span>
<span class="sd">                        0.00820733 9.78723e-23  ...</span>
<span class="sd">                        0.00871153 9.49468e-23  ...</span>
<span class="sd">                        0.00927176 9.06915e-23  ...</span>
<span class="sd">                        0.00974795 8.51064e-23  ...</span>
<span class="sd">                        0.0100561 7.95213e-23  ...</span>
<span class="sd">                        0.0102522 7.20745e-23  ...</span>
<span class="sd">                        0.0104482 6.2234e-23  ...</span>
<span class="sd">                        0.0106163 5.13298e-23  ...</span>
<span class="sd">                        0.0107564 4.12234e-23  ...</span>
<span class="sd">                        0.0108404 3.16489e-23  ...</span>
<span class="sd">                        0.0109524 2.12766e-23  ...</span>
<span class="sd">                        0.0110365 1.2234e-23  ...</span>
<span class="sd">                        0.0111485 4.78723e-24  ...</span>
<span class="sd">                        0.0112606 -3.19149e-24  ...</span>
<span class="sd">                        0.0113446 -8.51064e-24  ...</span>
<span class="sd">                        0.0115127 -1.30319e-23  ...</span>
<span class="sd">                        0.0115967 -1.43617e-23  ...</span>
<span class="sd">                        0.0118208 -1.38298e-23  ...</span>
<span class="sd">                        0.0120449 -1.03723e-23  ...</span>
<span class="sd">                        0.012325 -6.38298e-24  ...</span>
<span class="sd">                        0.0125771 -3.7234e-24  ...</span>
<span class="sd">                        0.0129132 -1.8617e-24  ...</span>
<span class="sd">                        0.0132214 -1.06383e-24  ...</span>
<span class="sd">                        0.0137536 -1.06383e-24  ...</span>
<span class="sd">                        0.0144259 -7.97872e-25  ...</span>
<span class="sd">                        0.0154343 -2.65957e-25  ...</span>
<span class="sd">                        0.0169749 0  ...</span>
<span class="sd">                        0.0194679 0 ]</span>

<span class="sd">                else</span>

<span class="sd">                    error([&#39;Model &#39; model &#39; unknown.&#39;])</span>

<span class="sd">                end</span>

<span class="sd">                # ---- Rescale waveform by user-specified distance and system mass.</span>
<span class="sd">                t_pregen = data(:,1) * mass / 10</span>
<span class="sd">                h_pregen = data(:,2) * (mass / distance) * (alphanew/alphadefault)</span>

<span class="sd">                # ---- Set first time stamp to zero, and resample to regular</span>
<span class="sd">                #      timestamps.</span>
<span class="sd">                t_pregen = t_pregen - t_pregen(1)</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = 16384</span>
<span class="sd">                t_resamp = [0:1/pregen_fs:t_pregen(end)].T</span>
<span class="sd">                h_resamp = interp1(t_pregen,h_pregen,t_resamp)</span>
<span class="sd">                pregen_T = length(h_resamp)/pregen_fs</span>
<span class="sd">                #</span>
<span class="sd">                hb = h_resamp</span>
<span class="sd">                hp = zeros(size(hb))</span>
<span class="sd">                hc = zeros(size(hb))</span>

<span class="sd">        elif family.lower() in [&#39;stamp_pt_a_tapered&#39;,&#39;stamp_adi_b_tapered&#39;,&#39;stamp_adi_e_tapered&#39;,&#39;stamp_pt_b_tapered&#39;,&#39;stamp_adi_c_tapered&#39;,&#39;stamp_adi_a_tapered&#39;,&#39;stamp_adi_d_tapered&#39;,&#39;stamp_maxgnetarf_tapered&#39;,&#39;stamp_maxgnetarg_tapered&#39;]:</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    disp([&#39;Loading &#39; lower(type) &#39;.mat catalog.&#39;])</span>
<span class="sd">                    data = load([filedir lower(type) &#39;.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Parse parameters.</span>
<span class="sd">                distance = parameters(1)  #-- mpc</span>
<span class="sd">                ciota    = parameters(2)  #-- inclination</span>

<span class="sd">                # ---- Extract +/x polarizations. Default distance is 1 mpc. Assume</span>
<span class="sd">                #      l=m=2 mode dominates when applying inclination.</span>
<span class="sd">                hp = 0.5*(1+ciota^2) * data.hp / distance</span>
<span class="sd">                hc =           ciota * data.hc / distance</span>

<span class="sd">                # ----  Set &quot;pregenerated&quot; variables.</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = data.fs</span>
<span class="sd">                pregen_T = length(hp)/data.fs</span>

<span class="sd">        elif family.lower() in [&#39;stamp_monoa&#39;,&#39;stamp_quadb&#39;,&#39;stamp_linea&#39;,&#39;stamp_monoc&#39;,&#39;stamp_sga&#39;,&#39;stamp_wnba&#39;,&#39;stamp_wnbc&#39;,&#39;stamp_lineb&#39;,&#39;stamp_quada&#39;,&#39;stamp_sgc&#39;,&#39;stamp_wnbb&#39;]:</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    disp([&#39;Loading &#39; lower(type) &#39;.mat catalog.&#39;])</span>
<span class="sd">                    data = load([filedir lower(type) &#39;.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Parse parameters. Note: don&#39;t call the requested hrss &quot;hrss&quot;</span>
<span class="sd">                #      because this name will trigger the hrss rescaling code at</span>
<span class="sd">                #      the end of this function.</span>
<span class="sd">                hrss_requested = parameters(1)  #-- mpc</span>
<span class="sd">                ciota          = parameters(2)  #-- inclination</span>

<span class="sd">                # ---- Extract +/x polarizations. Default hrss for STAMP-AS</span>
<span class="sd">                #      injection files is 1e-20. Assume l=m=2 mode dominates</span>
<span class="sd">                #      when applying inclination.</span>
<span class="sd">                hp = 0.5*(1+ciota^2) * data.hp * hrss_requested/1e-20</span>
<span class="sd">                hc =           ciota * data.hc * hrss_requested/1e-20</span>

<span class="sd">                # ----  Set &quot;pregenerated&quot; variables.</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = data.fs</span>
<span class="sd">                pregen_T = length(hp)/data.fs</span>

<span class="sd">        elif family.lower() in [&#39;wnb&#39;]:</span>

<span class="sd">                # ---- Turn off default interpolation.</span>
<span class="sd">                #      (Might actually be useful here, but don&#39;t want to alter</span>
<span class="sd">                #      frequency content of noise by low-pass filtering).</span>
<span class="sd">                pregen = 0</span>

<span class="sd">                # ---- Gaussian-modulated noise burst, white over specified band.</span>
<span class="sd">                h_rss = parameters(1)</span>
<span class="sd">                fc = parameters(2)</span>
<span class="sd">                df = parameters(3)</span>
<span class="sd">                dt = parameters(4)</span>
<span class="sd">                # ---- If fifth parameter is specified, use it to set the seed for</span>
<span class="sd">                #      the random number generator.</span>
<span class="sd">                #      KLUDGE: injections will be coherent only if all the</span>
<span class="sd">                #      detectors have the same sampling frequency.</span>
<span class="sd">                if(length(parameters)&gt;=5)</span>
<span class="sd">                    randn(&#39;state&#39;,parameters(5))</span>
<span class="sd">                end</span>
<span class="sd">                # ---- Gaussian envelope</span>
<span class="sd">                env = exp(-(t-T0).^2/2/dt.^2)</span>
<span class="sd">                # ---- Band-limited noise (independent for each polarization)</span>
<span class="sd">                x = BLWNB(max(fc-df,0),2*df,T,fs)</span>
<span class="sd">                x = x.T</span>
<span class="sd">                x = circshift(x,round((T0-1.5)*fs))</span>
<span class="sd">                hp = env.*x</span>
<span class="sd">                hp = hp*h_rss/(hp.T*hp/fs).^0.5</span>
<span class="sd">                x = BLWNB(max(fc-df,0),2*df,T,fs)</span>
<span class="sd">                x = x.T</span>
<span class="sd">                x = circshift(x,round((T0-1.5)*fs))</span>
<span class="sd">                hc = env.*x</span>
<span class="sd">                hc = hc*h_rss/(hc.T*hc/fs).^0.5</span>

<span class="sd">        elif family.lower() in [&#39;yakunin2010&#39;]:</span>

<span class="sd">                # ----  long-lived bar mode supernova waveform (pregenerated).</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = 16384</span>
<span class="sd">                pregen_T = 1</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    load([filedir &#39;Yakunin2010cat.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Find specified waveform type.</span>
<span class="sd">                NAME = parameters{1,2}</span>
<span class="sd">                for k=1:length(Yakunin2010cat)</span>
<span class="sd">                    if (strcmp(Yakunin2010cat(k).name,NAME))</span>
<span class="sd">                        wf_number = k</span>
<span class="sd">                    end</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Read waveform, which is defined at a range of 10kpc.</span>
<span class="sd">                #      Make sure h is same type of vector (column) as t.</span>
<span class="sd">                distance = 0.1*parameters{1}</span>
<span class="sd">                # note: if these are read in from column ascii files, no need to invert vector dims</span>
<span class="sd">                hp = 1./distance*Yakunin2010cat(wf_number).hp</span>
<span class="sd">                hc = 1./distance*Yakunin2010cat(wf_number).hc</span>

<span class="sd">        elif family.lower() in [&#39;zero&#39;]:</span>

<span class="sd">                # ---- Trivial (null) signal.  Useful to avoid scripts crashing.</span>
<span class="sd">                hp = zeros(size(t))</span>
<span class="sd">                hc = zeros(size(t))</span>

<span class="sd">                # ---- Turn off default interpolation.</span>
<span class="sd">                pregen = 0</span>

<span class="sd">        elif family.lower() in [&#39;zm&#39;]:</span>

<span class="sd">                # ---- Zwerger-Mueller supernova waveform (pregenerated).</span>
<span class="sd">                pregen = 1</span>
<span class="sd">                pregen_fs = 16384</span>
<span class="sd">                pregen_T = 1</span>

<span class="sd">                # ---- Load waveform structure, if not already loaded or supplied.</span>
<span class="sd">                if (isempty(catalog))</span>
<span class="sd">                    # disp(&#39;Loading Zwerger-Muller catalog.&#39;)</span>
<span class="sd">                    load([filedir &#39;ZMcat.mat&#39;])</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Find specified waveform type.</span>
<span class="sd">                NAME = parameters{1,2}</span>
<span class="sd">                for k=1:length(ZMcat)</span>
<span class="sd">                    if (strcmp(ZMcat(k).name,NAME))</span>
<span class="sd">                        ZM_number = k</span>
<span class="sd">                    end</span>
<span class="sd">                end</span>

<span class="sd">                # ---- Read waveform, which is defined at a range of 1mpc.</span>
<span class="sd">                #      Make sure h is same type of vector (column) as t.</span>
<span class="sd">                distance = 1e-3*parameters{1}</span>
<span class="sd">                h = 1./distance*ZMcat(ZM_number).hoft.T</span>
<span class="sd">                hp = h(:)</span>
<span class="sd">                hc = zeros(size(hp))</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Waveform family not recognized&quot;</span><span class="p">)</span>

    <span class="c1"># this waveform very well may not ave the scalar polarization defined.</span>
    <span class="c1"># therefore make it a time series of zeros</span>
    <span class="k">if</span> <span class="n">hb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="n">hb</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">hp</span><span class="o">.</span><span class="n">sample_rate</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="c1">###########################################################################</span>
    <span class="c1">#   Process pre-generated waveforms.</span>
    <span class="c1">###########################################################################</span>

    <span class="c1"># ---- Resample, time-shift, truncate, and/or zero-pad pregenerated</span>
    <span class="c1">#      waveform as needed.</span>
    <span class="c1"># ---- KLUDGE: We should issue warnings if any significant amount of the</span>
    <span class="c1">#      waveform (e.g., of hrss^2) is lost due to the shifting.</span>
    <span class="k">if</span> <span class="n">pregen</span><span class="p">:</span>

        <span class="c1"># ---- Time vector for pregenerated waveform.</span>
        <span class="n">pregen_t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pregen_T</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">pregen_fs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">pregen_t</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">hp</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">pregen_t</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">hc</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="ow">or</span>
           <span class="p">(</span><span class="n">pregen_t</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">hb</span><span class="o">.</span><span class="n">size</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Length of pregen_t &#39;</span>
                             <span class="s1">&#39;does not equal one of hb, hp, hc&#39;</span><span class="p">)</span>

        <span class="c1"># ---- Measure peak/characteristic time of pregenerated waveform.</span>
        <span class="p">[</span><span class="n">SNR</span><span class="p">,</span> <span class="n">h_rss</span><span class="p">,</span> <span class="n">h_peak</span><span class="p">,</span> <span class="n">Fchar</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">Tchar</span><span class="p">,</span> <span class="n">dur</span><span class="p">]</span> <span class="o">=</span> <span class="n">xoptimalsnr</span><span class="p">(</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hp</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">hc</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">hb</span><span class="o">.</span><span class="n">value</span><span class="p">]),</span> <span class="n">t0</span><span class="o">=</span><span class="n">pregen_t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">fs</span><span class="o">=</span><span class="n">pregen_fs</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dF</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">Fmin</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">pregen_T</span><span class="p">,</span> <span class="n">Fmax</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">pregen_fs</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="n">pregen_T</span><span class="p">)</span>

        <span class="c1"># ---- Shift pregenerated time vector by required amount.</span>
        <span class="n">pregen_t</span> <span class="o">=</span> <span class="n">pregen_t</span> <span class="o">+</span> <span class="p">(</span><span class="n">T0</span> <span class="o">-</span> <span class="n">Tchar</span><span class="p">)</span>
        <span class="c1"># ---- Interpolate to correct sampling rate and peak time.</span>
        <span class="c1"># ---- Time in column vector.</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
        <span class="c1"># ---- Find desired times which overlap pregen_t.</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">t</span><span class="o">&gt;=</span><span class="n">pregen_t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span><span class="o">&lt;=</span><span class="n">pregen_t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># ---- Interpolate, with zero padding if pregenerated waveform is too</span>
        <span class="c1">#      short.  (Truncation of long waveforms handled automatically by</span>
        <span class="c1">#      specifying vector &quot;t&quot;.)  Use spline rather than linear</span>
        <span class="c1">#      interpolation the latter effectively acts as a low-pass-filter</span>
        <span class="c1">#      which causes problems with high-frequency waveforms.</span>
        <span class="n">hp_interp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hc_interp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">hb_interp</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dx</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">,</span>
                               <span class="n">name</span><span class="o">=</span><span class="n">hp</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">hp_interp_function</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">pregen_t</span><span class="p">,</span> <span class="n">hp</span><span class="p">)</span>
        <span class="n">hc_interp_function</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">pregen_t</span><span class="p">,</span> <span class="n">hc</span><span class="p">)</span>
        <span class="n">hb_interp_function</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">pregen_t</span><span class="p">,</span> <span class="n">hb</span><span class="p">)</span>

        <span class="n">hp_interp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hp_interp_function</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">hc_interp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hc_interp_function</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">hb_interp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">hb_interp_function</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="n">hp</span> <span class="o">=</span> <span class="n">hp_interp</span>
        <span class="n">hc</span> <span class="o">=</span> <span class="n">hc_interp</span>
        <span class="n">hb</span> <span class="o">=</span> <span class="n">hb_interp</span>

    <span class="c1"># ---- Reset hrss amplitude to specified value, if any.</span>
    <span class="c1">#      For 2-polarization waveforms use hp^2+hc^2.</span>
    <span class="c1">#      Note: If the time-shifting moves a pre-generated waveform out of the</span>
    <span class="c1">#      interval of interest then this will screw up the amplitude!</span>
    <span class="c1">#if ( (hrss&gt;0) and (hrss)):</span>
    <span class="c1">#    normalization = ((hp*hp + hc*hc + hb*hb) / fs)**0.5</span>
    <span class="c1">#    hp = hp * hrss/normalization</span>
    <span class="c1">#    hc = hc * hrss/normalization</span>
    <span class="c1">#    hb = hb * hrss/normalization</span>

    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="n">hc</span><span class="p">,</span> <span class="n">hb</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Scott Coughlin

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>